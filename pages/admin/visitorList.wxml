<!--pages/admin/visitorList.wxml-->
<view class="container">
  <!-- æµ®åŠ¨æœç´¢æŒ‰é’® -->
  <view class="floating-search-btn" bindtap="showSearchModal">
    <text class="search-icon">ğŸ”</text>
  </view>

  <!-- æœç´¢æ¨¡æ€æ¡† -->
  <view class="search-modal-overlay" wx:if="{{showSearchModal}}" bindtap="hideSearchModal">
    <view class="search-modal-content" catchtap="preventBubble">
      <view class="search-modal-header">
        <text class="search-modal-title">æœç´¢å°åŒº</text>
        <view class="search-modal-close" bindtap="hideSearchModal">âœ•</view>
      </view>
      <view class="search-input-wrapper">
        <input 
          class="search-input" 
          placeholder="è¯·è¾“å…¥å°åŒºåç§°" 
          placeholder-style="text-align: left; line-height: 56px; vertical-align: middle;"
          value="{{filterCommunity}}" 
          bindinput="onSearchInput"
          confirm-type="search"
          bindconfirm="confirmSearch"
        />
      </view>
      <view class="search-modal-actions">
        <button class="search-btn-secondary" bindtap="clearSearch">æ¸…ç©º</button>
        <button class="search-btn-primary" bindtap="confirmSearch">ç¡®è®¤</button>
      </view>
    </view>
  </view>

  <!-- è®¿å®¢åˆ—è¡¨ - æ”¯æŒä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½ -->
  <scroll-view 
    class="visitor-list-scroll"
    scroll-y="true"
    refresher-enabled="true"
    refresher-triggered="{{loading}}"
    bindrefresherrefresh="onPullDownRefresh"
    bindscrolltolower="onScrollToLower"
    lower-threshold="100">
    
    <!-- åŠ è½½ä¸­çŠ¶æ€ -->
    <view class="loading" wx:if="{{loading}}">
      <text>æ­£åœ¨åŠ è½½è®¿å®¢ä¿¡æ¯...</text>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:elif="{{filteredVisitors.length === 0 && !loading}}">
      <text>æš‚æ— è®¿å®¢è®°å½•</text>
      <button class="retry-btn" bindtap="loadVisitors">é‡æ–°åŠ è½½</button>
    </view>
    
    <!-- è®¿å®¢åˆ—è¡¨ -->
    <view class="visitor-list">
      <view class="visitor-item" wx:for="{{filteredVisitors}}" wx:key="_id">
        <image class="avatar" src="{{item.avatarUrl}}" mode="aspectFill" />
        <view class="info">
          <view class="visitor-main-info">
            <view class="name">{{item.nickName}}</view>
            <view class="phone">{{item.phoneNumber}}</view>
            <view class="location">{{item.cityName}}/{{item.areaName}}/{{item.communityName}}</view>
            <view class="time">{{item.registerTime || item._createTime}}</view>
          </view>
        </view>
        <!-- ç”µè¯æŒ‰é’® -->
        <view class="phone-btn" bindtap="onCallPhone" data-phone="{{item.phoneNumber}}">
          <text class="phone-icon">âœ†</text>
        </view>
      </view>
    </view>
    
    <!-- åŠ è½½æ›´å¤šçŠ¶æ€ -->
    <view class="load-more" wx:if="{{filteredVisitors.length > 0}}">
      <view class="load-more-loading" wx:if="{{loadingMore}}">
        <text>æ­£åœ¨åŠ è½½æ›´å¤š...</text>
      </view>
      <view class="load-more-end" wx:elif="{{!hasMore}}">
        <text>å·²åŠ è½½å…¨éƒ¨æ•°æ®</text>
      </view>
      <view class="load-more-tips" wx:else>
        <text>ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>
    </view>
  </scroll-view>
  
  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="statistics" wx:if="{{!loading}}">
    <text>å½“å‰æ˜¾ç¤º {{filteredVisitors.length}} æ¡è®°å½•{{hasMore ? 'ï¼Œä¸Šæ‹‰åŠ è½½æ›´å¤š' : 'ï¼Œå·²åŠ è½½å…¨éƒ¨'}}</text>
  </view>
</view>
