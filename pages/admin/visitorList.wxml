<!--pages/admin/visitorList.wxml-->
<view class="container">
  <!-- ц╡охКицРЬч┤вцМЙщТо -->
  <view class="floating-search-btn" bindtap="showSearchModal">
    <text class="search-icon">ЁЯФН</text>
  </view>

  <!-- цРЬч┤вцибцАБцбЖ -->
  <view class="search-modal-overlay" wx:if="{{showSearchModal}}" bindtap="hideSearchModal">
    <view class="search-modal-content" catchtap="preventBubble">
      <view class="search-modal-header">
        <text class="search-modal-title">цРЬч┤вх░ПхМ║</text>
        <view class="search-modal-close" bindtap="hideSearchModal">тЬХ</view>
      </view>
      <view class="search-input-wrapper">
        <input 
          class="search-input" 
          placeholder="шп╖ш╛УхЕех░ПхМ║хРНчз░" 
          placeholder-style="text-align: left; line-height: 56px; vertical-align: middle;"
          value="{{filterCommunity}}" 
          bindinput="onSearchInput"
          confirm-type="search"
          bindconfirm="confirmSearch"
        />
      </view>
      <view class="search-modal-actions">
        <button class="search-btn-secondary" bindtap="clearSearch">ц╕Ечй║</button>
        <button class="search-btn-primary" bindtap="confirmSearch">чбошод</button>
      </view>
    </view>
  </view>

  <!-- шо┐ховхИЧшби - цФпцМБф╕ЛцЛЙхИ╖цЦ░хТМф╕КцЛЙхКаш╜╜ -->
  <scroll-view 
    class="visitor-list-scroll"
    scroll-y="true"
    refresher-enabled="true"
    refresher-triggered="{{loading}}"
    bindrefresherrefresh="onPullDownRefresh"
    bindscrolltolower="onScrollToLower"
    lower-threshold="100">
    
    <!-- хКаш╜╜ф╕нчК╢цАБ -->
    <view class="loading" wx:if="{{loading}}">
      <text>цнгхЬихКаш╜╜шо┐ховф┐бцБп...</text>
    </view>
    
    <!-- чй║чК╢цАБ -->
    <view class="empty" wx:elif="{{filteredVisitors.length === 0 && !loading}}">
      <text>цЪВцЧашо┐ховшо░х╜Х</text>
      <button class="retry-btn" bindtap="loadVisitors">щЗНцЦ░хКаш╜╜</button>
    </view>
    
    <!-- шо┐ховхИЧшби -->
    <view class="visitor-list">
      <view class="visitor-item" wx:for="{{filteredVisitors}}" wx:key="_id">
        <image class="avatar" src="{{item.displayAvatarUrl || item.avatarUrl}}" mode="aspectFill" binderror="onAvatarError" data-index="{{index}}" />
        <view class="info">
          <view class="visitor-main-info">
            <view class="name">{{item.nickName}}</view>
            <view class="phone">{{item.phoneNumber}}</view>
            <view class="location">{{item.formattedAddress}}</view>
            <view class="time">{{item.formattedTime}}</view>
          </view>
        </view>
        <!-- чФ╡шпЭцМЙщТо -->
        <view class="phone-btn" bindtap="onCallPhone" data-phone="{{item.phoneNumber}}">
          <text class="phone-icon">тЬЖ</text>
        </view>
      </view>
    </view>
    
    <!-- хКаш╜╜цЫ┤хдЪчК╢цАБ -->
    <view class="load-more" wx:if="{{filteredVisitors.length > 0}}">
      <view class="load-more-loading" wx:if="{{loadingMore}}">
        <text>цнгхЬихКаш╜╜цЫ┤хдЪ...</text>
      </view>
      <view class="load-more-end" wx:elif="{{!hasMore}}">
        <text>х╖▓хКаш╜╜хЕищГицХ░цНо</text>
      </view>
      <view class="load-more-tips" wx:else>
        <text>ф╕КцЛЙхКаш╜╜цЫ┤хдЪ</text>
      </view>
    </view>
  </scroll-view>
  
  <!-- ч╗Яшобф┐бцБп -->
  <view class="statistics" wx:if="{{!loading}}">
    <text>х╜УхЙНцШ╛чд║ {{filteredVisitors.length}} цЭбшо░х╜Х{{hasMore ? 'я╝Мф╕КцЛЙхКаш╜╜цЫ┤хдЪ' : 'я╝Мх╖▓хКаш╜╜хЕищГи'}}</text>
  </view>
</view>
